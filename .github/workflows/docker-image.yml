name: Docker Image CI
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  - name: Checkout code
    uses: actions/checkout@v3
  - name: Set up Docker Buildx
    uses: docker/setup-buildx-action@v2
  - name: Log in to Docker Hub
    uses: docker/login-action@v2
    with:
      username: ${{ secrets.DOCKER_HUB_USERNAME }}
      password: ${{ secrets.DOCKER_HUB_ACCESS_TOKEN }}
  - name: Build and tag Docker image
    run: |
      docker build . -t ${{ secrets.DOCKER_HUB_USERNAME }}/linkedin-pw:latest
      docker tag ${{ secrets.DOCKER_HUB_USERNAME }}/linkedin-pw:latest ${{ secrets.DOCKER_HUB_USERNAME }}/linkedin-pw:${{ github.sha }}
  - name: Push Docker image
    run: |
      docker push ${{ secrets.DOCKER_HUB_USERNAME }}/linkedin-pw:latest
      docker push ${{ secrets.DOCKER_HUB_USERNAME }}/linkedin-pw:${{ github.sha }}
